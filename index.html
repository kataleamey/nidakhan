<!DOCTYPE html>
<html lang="en">
<head>
    <title>Nida Khan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">
	<!--- Bootstrap 5 CSS link --->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--- Font Awesom CSS link --->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 	<!--- Live Jquery URL--->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <!--- Bootstrap 5 Jquery URL--->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--- Owl Carousel Js And CSS For Testimonial Slider--->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css">
    <!--- style.css, where we will write our custom css--->
    <link rel="stylesheet" href="./style.css">
    <!-- script -->
    <script src="./script.js"></script>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg sticky-top  " id="navbar_top">
        <div class="container header-container"> <a class="navbar-brand" href="#">Nida Khan</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-collapse-toggle" aria-expanded="false"><span class="navbar-toggler-icon"></span></button>
          <div class="collapse navbar-collapse justify-content-end" id="navbar-collapse-toggle">
            <ul class="navbar-nav ml-auto">
              <li><a href="./index.html"><span>Home</span></a></li>
              <li><a href="./service.html"><span>Services</span></a></li>
              <li><a href="./about.html"><span>About Us</span></a></li>
              <li><a href="./contact.html"><span>Contact Us</span></a></li>
            </ul>
            <a href="#"><button class="brocherbutton">Brochure</button></a>
          </div>
        </div>
    </nav>

    <!-- Banner container -->
    <div class="container-fluid banner-img">
        <div class="banner-content row">
            <div class="col-lg-12 col-sm-12 banner-content-col">
                <h1>A Safe Space for Your <br>Emotional Well-Being</h1>
                <h2 class="banner-service">To bring spark in your Marriage <br>Express Freely, Understand Deeply, Grow Fully, Self Love</h2>
                <h2 class="banner-free-h2">Get 30 Minutes Free Session</h2>
                <a href="./contact.html"><button class="book-button">Book Your Session</button></a>
            </div>
        </div>
    </div>

    <!-- Overview section -->
    <div class="container overview-section">   
        <div class="container">
            <h2 class="overview-h2">I'm Nida Khan, a Life Coach | Relationship Coach</h2>
            <p style="text-align: center; font-size: 20px;"><b>Live a Happy married life that thrives year ahead</b></p>
            <div class="overview-content row">
                <div class="col-lg-6 col-sm-12">
                    <p>We are here to evolve and become our Highest Self. Whether aspiring to be an inspiring leader who leads with calm and presence, 
                        or seeking more contentment at work and fulfillment in relationships, personal transformation begins with inner work and higher self-awareness.</p>
                    <p>Personal growth isn't about perfectionâ€”it's about progression. As your life coach, I guide you through transformative journeys of self-discovery, 
                        helping you navigate complex relationship dynamics and professional challenges with increased emotional intelligence and clarity.</p>
                    <p>When you commit to becoming your 'Best Version', you naturally start to excel in every life domain. By connecting with your inner wisdom, 
                        you gain profound clarity, enabling more authentic and meaningful experiences across professional and personal landscapes, ultimately creating deeper, more fulfilling relationships and a more purposeful life.</p>
                </div>
                <div class="col-lg-6 col-sm-12 overview-img">
                    <img src='./img/TopCoach.jpg'>
                </div>
                <div class="button-connect">
                    <a href="./contact.html"><button class="connect-me">CONNECT WITH ME</button></a>
                </div>
            </div>
        </div>
    </div>


     <!-- services section -->
      <div class="container">
        <div class="services row">
            <h2 class="overview-h2 service-h2">Life & Relation Coaching Services</h2>
            <div class="col-lg-3 col-md-6 col-sm-12 service-grid">
                <div class="card">
                    <img src="./img/Dipression.png" class="card-img-top" alt="Depression">
                    <div class="card-body">
                      <h5 class="card-title">Depression</h5>
                      <p class="card-text">A transformative journey addressing emotional challenges, helping you rebuild inner strength and restore personal hope.</p>   
                    </div>
                  </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 service-grid">
                <div class="card">
                    <img src="./img/anxiety.png" class="card-img-top" alt="...">
                    <div class="card-body">
                      <h5 class="card-title">Anxiety</h5>
                      <p class="card-text">A focused approach deconstructing complex emotional layers, developing adaptive skills that increase confidence and resilience.</p>
                    </div>
                  </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 service-grid">
                <div class="card">
                    <img src="./img/Relationship issue.png" class="card-img-top" alt="...">
                    <div class="card-body">
                      <h5 class="card-title">Relationship Issues</h5>
                      <p class="card-text">A supportive coaching process enhancing communication, establishing boundaries, and creating meaningful personal connections.</p>
                    </div>
                  </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-12 service-grid">
                <div class="card">
                    <img src="./img/stress1.png" class="card-img-top" alt="...">
                    <div class="card-body">
                      <h5 class="card-title">Stress Management</h5>
                      <p class="card-text">A holistic strategy analyzing your unique challenges, integrating mindfulness and wellness techniques for personal growth.</p>
                    </div>
                  </div>
            </div>
        </div>
      </div>

      <!-- Impact section -->
       <div class="container-fluid impact-section">
        <div class="container">
            <div class="impact row">
                <div class="col-lg-4 col-sm-12 impact-left">
                    <h2>Get Started Now</h2>
                    <p>Express Freely, Understand Deeply, Grow Fully</p>
                    <p>Multiply your Impact</p>
                    <p>Live with Purpose!</p>
                </div>
                <div class="col-lg-8 col-sm-12 impact-right">
                    <h2>Ready To Grow and Amplify Your Impact?</h2>
                    <ul class="impact-list">
                        <li>Handle any conflict or situation with calm and poise.</li>
                        <li>Express yourself effectively & assertively.</li>
                        <li>Exude magnetic leadership presence.</li>
                    </ul>
                    <a href="./contact.html"><button class="impact-button">Book Your Session</button></a>
                </div>
            </div>
        </div>
       </div>


       <!-- Testimonial -->
       <div class="container testimonial-slider">
        <h2 class="overview-h2">Review's</h2>
        <div class="row">
            <div class="col-12">
                <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="d-flex justify-content-center">
                                <div class="testimonial-card col-md-8 col-lg-6">
                                    <img src="./img/review-1.jpg" alt="Testimonial 1" class="testimonial-image">
                                    <p class="testimonial-quote">"It was an incredible breakthrough call. I expressed my concerns with the thought that I may be overthinking the issues at hand. You are such a wonderful guide, helping people navigate emotional struggles. The 30-minute session felt like a deep dive into personal growth, like attending a full-day seminar on happiness. Truly grateful!"</p>
                                    <h5 class="testimonial-name">Mehvish Khan</h5>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="d-flex justify-content-center">
                                <div class="testimonial-card col-md-8 col-lg-6">
                                    <img src="./img/review-2.jpg" alt="Testimonial 2" class="testimonial-image">
                                    <p class="testimonial-quote">"The session was incredibly eye-opening! I came in thinking my challenges were more overwhelming than they actually were, but you helped me gain clarity and perspective. Your guidance in addressing emotional blockages is truly remarkable. The insights and encouragement I received were invaluable and have made a lasting impact on my relationship."</p>
                                    <h5 class="testimonial-name">Priyanka Singh</h5>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="d-flex justify-content-center">
                                <div class="testimonial-card col-md-8 col-lg-6">
                                    <img src="./img/review-3.jpg" alt="Testimonial 3" class="testimonial-image">
                                    <p class="testimonial-quote">"What an insightful call! I started by sharing my worries, thinking I might be amplifying my concerns unnecessarily. You really are a fantastic mentor, especially for individuals struggling with mental distress. The session felt so enriching, like a mini-seminar packed with valuable lessons, even though it was just 30 minutes."</p>
                                    <h5 class="testimonial-name">Sakshi Surve</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel Controls -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- call to action  -->
    <div class="container-fluid main-section" style="margin-bottom: 80px">
        <div class="container">
          <!-- <div class="heading">
            <h2 style="text-align: center; margin-bottom: 10px;"><span class="heading-border"></span> CONTACT ME<span class="heading-border"></span></h2>
          </div> -->
          <div class="row">
            <div class="col-md-4">
              <div class="contact-info">
                <div class="contact-left">
                  <h3>Email</h3>
                  <a href="mailto:nidazainah7@gmail.com">nidazainah7@gmail.com</a></div>
                <div class="contact-left">
                  <h3>Visit Address</h3>
                  <p>Warnwe Park Streetperrine<br>
                    FL 33157 Mumbai</p>
                </div>
                <div class="contact-left">
                  <h3>Phone</h3>
                  <p>+91 9324614699</p>
                </div>
                <div class="contact-left">
                    <h3>1-2-1 Coaching</h3>
                  </div>
                <ul>
                  <li><a href="https://www.instagram.com/lifecoach_nidakhan" target="_blank"><i class="fa fa-instagram" style="padding-right: 10px;"></i>@lifecoach_nidakhan</a></li>
                </ul>
              </div>
            </div>
            <div class="col-md-8 res-mt">
                <div class="contact-form">
                    <h3>Get In Touch</h3>
                    <div class="row mt-4">
                      <div class="col-md-6 col-12 mt-4">
                        <input type="text" placeholder="Your Name *" class="form-control" required>
                      </div>
                      <div class="col-md-6 col-12 mt-4">
                        <input type="email" placeholder="Your Email *" class="form-control" required>
                      </div>
                      <div class="col-md-12 col-12 mt-4">
                        <input type="text" placeholder="Your Subject *" class="form-control" required>
                      </div>
                      <div class="col-md-12 col-12 mt-4">
                        <textarea placeholder="Your Message *" class="form-control"></textarea>
                      </div>
                      <div class="col-md-12 col-12 mt-4">
                        <button class="btn btn-lg submitform" onclick="submitForm()">Contact Us</button>
                      </div>
                    </div>
                  </div>
                  
                  <div id="success-message" class="success-container" style="display: none;">
                    <div class="success-content">
                      <button class="close-btn" onclick="hideSuccessMessage()">
                        <i class="fas fa-times"></i>
                      </button>
                      <i class="success-icon fas fa-check-circle"></i>
                      <h3 class="success-title">Thank You!</h3>
                      <p class="success-message">We've received your message and will get back to you as soon as possible.</p>
                    </div>
                  </div>
            </div>   
            </div>
        </div>
      </div>
    
    <!-- footer -->
    <footer class="footer">
        <div class="container">
            <div class="foot-container">
                <div class="logo"><a class="navbar-brand" href="#">Nida Khan</a></div>
                <div><p><b>Usefull Links</b></p>
                    <ul class="useful-links">
                        <li><a href="./index.html">Home</a></li>
                        <li><a href="./service.html">Services</a></li>
                        <li><a href="./about.html">About</a></li>
                        <li><a href="./contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="foot-working">
                    <table>
                        <th>Working Hours</th>
                        <tr>
                            <td class="time"><span>11.00 AM</span> - <span>5.00 PM</span></td>
                            <td>Monday To Wednesday</td>
                        </tr>
                    </table>
                </div>
                <div class="foot-brochure">
                    <ul>
                        <li class="social"><a href="https://www.instagram.com/lifecoach_nidakhan"><i style="font-size:22px" class="fa">&#xf16d;</i>@lifecoach_nidakhan</a></li>
                        <li class="social"><i style="font-size:20px" class="fa">&#xf003;</i>nidazainah7@gmail.com</li>
                        <li style="margin-top: 10px;">1-2-1 Coaching</li>
                        <li><a href="#">Download Brochure</a></li>
                        <li><a href="#">Contact Me</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- copyright footer -->
     <div class="container-fluid copyright-container">
        <div class="container">
            <div class="copyright-footer row">
                <div class="col-lg-8 col-sm-12">Â© Copyright 2025, Nida Khan. All Rights Reserved</div>
                <div class="col-lg-4 col-sm-12" style="text-align: end;">Privacy Policy</div>
            </div>
        </div>
     </div>

    
    <!-- Bootstrap JS and Popper.js -->
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>

	<!-- Add this complete script before closing </body> tag -->
<script>
(function() {
    // Configuration - Update this with your server URL
    const API_BASE = 'http://localhost:8080/api/support'; // Change to your actual server URL
    
    // Create widget HTML
    const widgetHTML = `
        <div id="supportChatWidget" style="position: fixed; bottom: 20px; right: 20px; z-index: 10000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <button id="chatToggle" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: all 0.3s ease; color: white; font-size: 24px;">
                <span id="toggleIcon">ðŸ’¬</span>
            </button>
            
            <div id="chatWindow" style="position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: none; flex-direction: column; overflow: hidden;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; position: relative;">
                    <div style="position: absolute; top: 15px; left: 15px; width: 12px; height: 12px; border-radius: 50%; background: #28a745; border: 2px solid white;" id="statusIndicator"></div>
                    <button style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 20px; cursor: pointer; opacity: 0.8;" onclick="closeChat()">Ã—</button>
                    <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Support Chat</h3>
                    <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;" id="headerStatus">We're here to help!</p>
                </div>
                
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <!-- Initial Form -->
                    <div id="chatForm" style="padding: 20px; border-bottom: 1px solid #eee;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">Your Name *</label>
                            <input type="text" id="clientName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">Your Email *</label>
                            <input type="email" id="clientEmail" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">Subject *</label>
                            <input type="text" id="ticketSubject" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">How can we help you?</label>
                            <textarea id="ticketDescription" placeholder="Describe your issue..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical; min-height: 80px; box-sizing: border-box;"></textarea>
                        </div>
                        <button type="button" onclick="startChat()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer;">Start Chat</button>
                    </div>
                    
                    <!-- Waiting Screen -->
                    <div id="waitingScreen" style="display: none; text-align: center; padding: 40px 20px; color: #666;">
                        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                        <h4>Please wait...</h4>
                        <p>A support agent will connect with you soon.</p>
                        <p id="waitingPosition"></p>
                    </div>
                    
                    <!-- Chat Interface -->
                    <div id="chatInterface" style="display: none; flex: 1; flex-direction: column;">
                        <div id="chatMessages" style="flex: 1; padding: 20px; overflow-y: auto; max-height: 300px;"></div>
                        <div style="padding: 20px; border-top: 1px solid #eee; background: #f8f9fa;">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="messageInput" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; font-size: 14px; outline: none;">
                                <button onclick="sendMessage()" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;">âž¤</button>
                            </div>
                            <div id="templateButtons" style="display: none; margin-top: 15px; text-align: center;">
                                <button onclick="respondToTemplate('yes')" style="margin: 0 5px; padding: 8px 20px; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; background: #28a745; color: white;">Yes</button>
                                <button onclick="respondToTemplate('no')" style="margin: 0 5px; padding: 8px 20px; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; background: #dc3545; color: white;">No</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            #supportChatWidget #chatToggle:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 25px rgba(0,0,0,0.4);
            }
            
            #supportChatWidget .message {
                margin-bottom: 15px;
                padding: 12px;
                border-radius: 12px;
                max-width: 85%;
                word-wrap: break-word;
            }
            
            #supportChatWidget .message.client {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                margin-left: auto;
                text-align: right;
            }
            
            #supportChatWidget .message.support {
                background: #f1f3f4;
                color: #333;
                margin-right: auto;
            }
            
            #supportChatWidget .message.system {
                background: #fff3cd;
                color: #856404;
                text-align: center;
                margin: 10px auto;
                font-style: italic;
                border: 1px solid #ffeaa7;
            }
            
            #supportChatWidget .message.template {
                background: #e8f4fd;
                color: #0c5460;
                margin-right: auto;
                border-left: 4px solid #17a2b8;
            }
            
            #supportChatWidget .message-time {
                font-size: 11px;
                opacity: 0.7;
                margin-top: 5px;
            }
            
            @media (max-width: 480px) {
                #supportChatWidget #chatWindow {
                    width: 300px;
                    height: 450px;
                    bottom: 70px;
                    right: -10px;
                }
            }
        </style>
    `;
    
    // Insert widget into page
    document.addEventListener('DOMContentLoaded', function() {
        document.body.insertAdjacentHTML('beforeend', widgetHTML);
        initializeChatWidget();
    });
    
    // Initialize widget functionality
    function initializeChatWidget() {
        let currentTicket = null;
        let chatInterval = null;
        let isWaiting = false;
        let lastMessageCount = 0;

        // Make functions global so they can be called from onclick handlers
        window.toggleChat = function() {
            const chatWindow = document.getElementById('chatWindow');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
                chatWindow.style.display = 'flex';
                toggleIcon.textContent = 'Ã—';
                
                if (currentTicket) {
                    startMessagePolling();
                }
            } else {
                chatWindow.style.display = 'none';
                toggleIcon.textContent = 'ðŸ’¬';
                
                if (chatInterval) {
                    clearInterval(chatInterval);
                }
            }
        };

        window.closeChat = function() {
            document.getElementById('chatWindow').style.display = 'none';
            document.getElementById('toggleIcon').textContent = 'ðŸ’¬';
            
            if (chatInterval) {
                clearInterval(chatInterval);
            }
        };

        window.startChat = async function() {
            const name = document.getElementById('clientName').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            const subject = document.getElementById('ticketSubject').value.trim();
            const description = document.getElementById('ticketDescription').value.trim();

            if (!name || !email || !subject) {
                alert('Please fill in all required fields.');
                return;
            }

            const submitBtn = document.querySelector('#chatForm button');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating ticket...';

            try {
                const ticket = {
                    clientName: name,
                    clientEmail: email,
                    subject: subject,
                    description: description
                };

                const response = await fetch(`${API_BASE}/tickets/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(ticket)
                });

                if (response.ok) {
                    currentTicket = await response.json();
                    
                    document.getElementById('chatForm').style.display = 'none';
                    
                    if (currentTicket.status === 'ON_HOLD') {
                        showWaitingScreen();
                    } else {
                        showChatInterface();
                    }
                } else {
                    throw new Error('Failed to create ticket');
                }
            } catch (error) {
                alert('Failed to start chat. Please try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Chat';
            }
        };

        function showWaitingScreen() {
            document.getElementById('waitingScreen').style.display = 'block';
            document.getElementById('headerStatus').textContent = 'Waiting for agent...';
            document.getElementById('statusIndicator').style.background = '#dc3545';
            isWaiting = true;
            
            const waitingInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE}/tickets/fetch/${currentTicket.id}`);
                    const updatedTicket = await response.json();
                    
                    if (updatedTicket.status !== 'ON_HOLD') {
                        clearInterval(waitingInterval);
                        currentTicket = updatedTicket;
                        document.getElementById('waitingScreen').style.display = 'none';
                        showChatInterface();
                    } else {
                        updateWaitingPosition();
                    }
                } catch (error) {
                    console.error('Error checking ticket status:', error);
                }
            }, 3000);
        }

        async function updateWaitingPosition() {
            try {
                const response = await fetch(`${API_BASE}/tickets/waiting-count`);
                const data = await response.json();
                const position = data.waitingCount;
                
                document.getElementById('waitingPosition').textContent = 
                    position > 0 ? `You are #${position} in queue` : 'You\'re next in line!';
            } catch (error) {
                console.error('Error getting waiting position:', error);
            }
        }

        function showChatInterface() {
            document.getElementById('chatInterface').style.display = 'flex';
            document.getElementById('headerStatus').textContent = 'Connected';
            document.getElementById('statusIndicator').style.background = '#28a745';
            isWaiting = false;
            
            loadMessages();
            startMessagePolling();
        }

        async function loadMessages() {
            if (!currentTicket) return;

            try {
                const response = await fetch(`${API_BASE}/chat/messages/${currentTicket.id}`);
                const messages = await response.json();
                
                if (messages.length !== lastMessageCount) {
                    displayMessages(messages);
                    lastMessageCount = messages.length;
                    
                    const lastMessage = messages[messages.length - 1];
                    if (lastMessage && lastMessage.messageType === 'TEMPLATE') {
                        showTemplateButtons();
                    }
                }
            } catch (error) {
                console.error('Failed to load messages:', error);
            }
        }

        function displayMessages(messages) {
            const chatMessages = document.getElementById('chatMessages');
            
            chatMessages.innerHTML = messages.map(message => `
                <div class="message ${message.messageType.toLowerCase()}">
                    <div>${message.content}</div>
                    <div class="message-time">${formatTime(message.sentDate)}</div>
                </div>
            `).join('');
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        window.sendMessage = async function() {
            if (!currentTicket) return;

            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();

            if (!content) return;

            try {
                const message = {
                    content: content,
                    senderName: currentTicket.clientName,
                    messageType: 'CLIENT'
                };

                const response = await fetch(`${API_BASE}/chat/send/${currentTicket.id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(message)
                });

                if (response.ok) {
                    messageInput.value = '';
                    hideTemplateButtons();
                    loadMessages();
                }
            } catch (error) {
                console.error('Failed to send message:', error);
            }
        };

        function showTemplateButtons() {
            document.getElementById('templateButtons').style.display = 'block';
            document.getElementById('messageInput').disabled = true;
            document.getElementById('messageInput').placeholder = 'Please respond using the buttons above';
        }

        function hideTemplateButtons() {
            document.getElementById('templateButtons').style.display = 'none';
            document.getElementById('messageInput').disabled = false;
            document.getElementById('messageInput').placeholder = 'Type your message...';
        }

        window.respondToTemplate = async function(response) {
            if (!currentTicket) return;

            try {
                const message = {
                    content: response === 'yes' ? 'Yes, I have more questions.' : 'No, that\'s all. Thank you!',
                    senderName: currentTicket.clientName,
                    messageType: 'CLIENT'
                };

                await fetch(`${API_BASE}/chat/send/${currentTicket.id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(message)
                });

                hideTemplateButtons();
                
                if (response === 'no') {
                    setTimeout(() => {
                        const chatMessages = document.getElementById('chatMessages');
                        chatMessages.innerHTML += `
                            <div class="message system">
                                <div>Thank you for using our support! This chat will close automatically.</div>
                            </div>
                        `;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                        setTimeout(() => {
                            closeChat();
                            resetChat();
                        }, 3000);
                    }, 1000);
                }
                
                loadMessages();
            } catch (error) {
                console.error('Failed to respond to template:', error);
            }
        };

        function startMessagePolling() {
            if (chatInterval) {
                clearInterval(chatInterval);
            }
            
            chatInterval = setInterval(() => {
                if (currentTicket && !isWaiting) {
                    loadMessages();
                }
            }, 2000);
        }

        function resetChat() {
            currentTicket = null;
            lastMessageCount = 0;
            document.getElementById('chatForm').style.display = 'block';
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'none';
            document.getElementById('headerStatus').textContent = 'We\'re here to help!';
            
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('ticketSubject').value = '';
            document.getElementById('ticketDescription').value = '';
            
            if (chatInterval) {
                clearInterval(chatInterval);
            }
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Add click handler to toggle button
        document.getElementById('chatToggle').addEventListener('click', toggleChat);
        
        // Add enter key handler to message input
        document.getElementById('messageInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    }
})();
</script>

</body>
</html>
